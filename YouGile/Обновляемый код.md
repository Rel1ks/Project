```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Universal Launcher - –ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Windows –∏ Linux
–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
"""

import json
import os
import platform
import subprocess
import sys
from dataclasses import dataclass
from pathlib import Path
from typing import Dict, List, Optional, Tuple


@dataclass
class AppInfo:
    name: str
    command: str
    category: str
    description: str = ""
    icon: str = "üì¶"


class UniversalLauncher:
    def __init__(self):
        self.os_type = platform.system().lower()
        self.is_windows = self.os_type == "windows"
        self.is_linux = self.os_type == "linux"

        if not (self.is_windows or self.is_linux):
            print("‚ùå –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ Windows –∏ Linux")
            sys.exit(1)

        self.apps: Dict[str, AppInfo] = {}
        self.favorites: List[str] = []
        self.config_dir = Path.home() / ".universal_launcher"
        self.config_file = self.config_dir / "config.json"
        self.last_message = ""
        self.last_message_type = ""  # 'success', 'error', 'info'

        self._ensure_config()
        self._detect_apps()
        self._load_favorites()

    def _clear_and_redraw(self):
        """–û—á–∏—Å—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞ –∏ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"""
        # –û—á–∏—Å—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞
        if self.is_windows:
            os.system("cls")
        else:
            os.system("clear")

        # –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        self._draw_header()
        self._draw_apps()
        self._draw_help()
        self._draw_message()

    def _draw_header(self):
        """–†–∏—Å—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫"""
        os_icon = "ü™ü" if self.is_windows else "üêß"
        os_name = "Windows" if self.is_windows else "Linux"

        print(f"‚ïî{'‚ïê' * 58}‚ïó")
        print(f"‚ïë{'üöÄ UNIVERSAL LAUNCHER'.center(56)}‚ïë")
        print(f"‚ïë{f'{os_icon} {os_name}'.center(56)}‚ïë")
        print(f"‚ï†{'‚ïê' * 58}‚ï£")
        print(
            f"‚ïë –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π: {len(self.apps):<3} ‚îÇ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ: {len(self.favorites):<3}            ‚ïë"
        )
        print(f"‚ïö{'‚ïê' * 58}‚ïù")

    def _draw_apps(self):
        """–†–∏—Å—É–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"""
        if not self.apps:
            print("\n  ‚ö†Ô∏è  –ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π")
            return

        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        categories: Dict[str, List[Tuple[str, AppInfo]]] = {}
        for key, app in self.apps.items():
            if app.category not in categories:
                categories[app.category] = []
            categories[app.category].append((key, app))

        print("\n" + "‚îÄ" * 60)

        self.index_map: Dict[int, str] = {}
        idx = 1

        for cat in sorted(categories.keys()):
            apps = sorted(categories[cat], key=lambda x: x[1].name)
            print(f"\n  üìÇ {cat}")
            print("  " + "‚îÄ" * 40)

            for key, app in apps:
                self.index_map[idx] = key
                fav = "‚≠ê" if key in self.favorites else "  "
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
                line = f"  {idx:2}.{fav} {app.icon} {app.name}"
                print(line[:58])
                idx += 1

        print("\n" + "‚îÄ" * 60)

    def _draw_help(self):
        """–†–∏—Å—É–µ–º —Å–ø—Ä–∞–≤–∫—É"""
        print("""
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ  üí° –ö–û–ú–ê–ù–î–´: [—á–∏—Å–ª–æ] –∑–∞–ø—É—Å–∫ ‚îÇ [–∏–º—è] –∑–∞–ø—É—Å–∫ ‚îÇ [URL]     ‚îÇ
  ‚îÇ     fav [—á–∏—Å–ª–æ] - –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ  ‚îÇ  favs - –ø–æ–∫–∞–∑–∞—Ç—å       ‚îÇ
  ‚îÇ     search [—Ç–µ–∫—Å—Ç] - –ø–æ–∏—Å–∫  ‚îÇ  refresh - –æ–±–Ω–æ–≤–∏—Ç—å       ‚îÇ
  ‚îÇ     help - —Å–ø—Ä–∞–≤–∫–∞  ‚îÇ  quit/q - –≤—ã—Ö–æ–¥                    ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò""")

    def _draw_message(self):
        """–†–∏—Å—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)"""
        if self.last_message:
            icon = {"success": "‚úÖ", "error": "‚ùå", "info": "‚ÑπÔ∏è ", "warning": "‚ö†Ô∏è "}.get(
                self.last_message_type, "‚Ä¢"
            )

            print(f"\n  {icon} {self.last_message}")
            print()  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ—Ç—Å—Ç—É–ø–∞

    def _set_message(self, text: str, msg_type: str = "info"):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
        self.last_message = text
        self.last_message_type = msg_type

    def _clear_message(self):
        """–û—á–∏—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"""
        self.last_message = ""
        self.last_message_type = ""

    def _ensure_config(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        self.config_dir.mkdir(exist_ok=True)

    def _save_favorites(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"""
        try:
            with open(self.config_file, "w", encoding="utf-8") as f:
                json.dump({"favorites": self.favorites}, f)
        except:
            pass

    def _load_favorites(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"""
        try:
            if self.config_file.exists():
                with open(self.config_file, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    self.favorites = data.get("favorites", [])
        except:
            pass

    def _run_command(self, command: str, shell: bool = False) -> bool:
        """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥—ã"""
        try:
            if self.is_windows:
                if shell or any(
                    cmd in command.lower()
                    for cmd in [
                        "start ",
                        "explorer",
                        "notepad",
                        "calc",
                        "cmd",
                        "powershell",
                    ]
                ):
                    subprocess.Popen(
                        command,
                        shell=True,
                        creationflags=subprocess.CREATE_NEW_PROCESS_GROUP,
                    )
                else:
                    subprocess.Popen(
                        command,
                        shell=False,
                        creationflags=subprocess.CREATE_NEW_PROCESS_GROUP,
                    )
            else:
                subprocess.Popen(
                    command,
                    shell=True,
                    stdout=subprocess.DEVNULL,
                    stderr=subprocess.DEVNULL,
                    start_new_session=True,
                )
            return True
        except Exception as e:
            self._set_message(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}", "error")
            return False

    def _which(self, program: str) -> Optional[str]:
        """–ü–æ–∏—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ PATH"""
        try:
            if self.is_windows:
                result = subprocess.run(
                    ["where", program], capture_output=True, text=True
                )
            else:
                result = subprocess.run(
                    ["which", program], capture_output=True, text=True
                )

            if result.returncode == 0:
                return result.stdout.strip().split("\n")[0]
        except:
            pass
        return None

    def _is_url(self, text: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ URL"""
        text = text.strip()
        return text.startswith(("http://", "https://", "www.")) or (
            "." in text and " " not in text and len(text) > 4
        )

    def _open_url(self, url: str) -> bool:
        """–û—Ç–∫—Ä—ã—Ç–∏–µ URL"""
        url = url.strip()
        if url.startswith("www."):
            url = "https://" + url

        try:
            if self.is_windows:
                os.system(f'start "" "{url}"')
            else:
                try:
                    subprocess.run(["xdg-open", url], check=True)
                except:
                    import webbrowser

                    webbrowser.open(url)
            self._set_message(f"–û—Ç–∫—Ä—ã—Ç–æ: {url[:50]}", "success")
            return True
        except Exception as e:
            self._set_message(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å: {e}", "error")
            return False

    def _scan_windows(self):
        """–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Windows –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"""
        system_commands = {
            "notepad": ("–ë–ª–æ–∫–Ω–æ—Ç", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä", "üìù"),
            "calc": ("–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", "üßÆ"),
            "explorer": ("–ü—Ä–æ–≤–æ–¥–Ω–∏–∫", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä", "üìÅ"),
            "cmd": ("–ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "CMD", "üíª"),
            "powershell": ("PowerShell", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "PowerShell", "‚ö°"),
            "mspaint": ("Paint", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä", "üé®"),
            "taskmgr": ("–î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "Task Manager", "üìä"),
            "control": ("–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–°–∏—Å—Ç–µ–º–Ω—ã–µ", "Control Panel", "‚öôÔ∏è"),
        }

        for cmd, (name, cat, desc, icon) in system_commands.items():
            self.apps[cmd] = AppInfo(name, cmd, cat, desc, icon)

        program_files = [
            os.environ.get("ProgramFiles", "C:\\Program Files"),
            os.environ.get("ProgramFiles(x86)", "C:\\Program Files (x86)"),
            os.path.expanduser("~\\AppData\\Local"),
            os.path.expanduser("~\\AppData\\Roaming"),
        ]

        known_apps = {
            "chrome": (
                "Google\\Chrome\\Application\\chrome.exe",
                "–ë—Ä–∞—É–∑–µ—Ä—ã",
                "Google Chrome",
                "üåê",
            ),
            "firefox": (
                "Mozilla Firefox\\firefox.exe",
                "–ë—Ä–∞—É–∑–µ—Ä—ã",
                "Mozilla Firefox",
                "ü¶ä",
            ),
            "edge": (
                "Microsoft\\Edge\\Application\\msedge.exe",
                "–ë—Ä–∞—É–∑–µ—Ä—ã",
                "Microsoft Edge",
                "üåä",
            ),
            "opera": ("Opera\\launcher.exe", "–ë—Ä–∞—É–∑–µ—Ä—ã", "Opera", "üî¥"),
            "code": ("Microsoft VS Code\\Code.exe", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "VS Code", "üíª"),
            "sublime": (
                "Sublime Text\\sublime_text.exe",
                "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
                "Sublime Text",
                "üìù",
            ),
            "notepad++": ("Notepad++\\notepad++.exe", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "Notepad++", "üìù"),
            "pycharm": (
                "JetBrains\\PyCharm\\bin\\pycharm64.exe",
                "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
                "PyCharm",
                "üêç",
            ),
            "discord": ("Discord\\Discord.exe", "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "Discord", "üí¨"),
            "telegram": (
                "Telegram Desktop\\Telegram.exe",
                "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏",
                "Telegram",
                "‚úàÔ∏è",
            ),
            "steam": ("Steam\\steam.exe", "–ò–≥—Ä—ã", "Steam", "üéÆ"),
            "spotify": ("Spotify\\Spotify.exe", "–ú–µ–¥–∏–∞", "Spotify", "üéµ"),
            "vlc": ("VideoLAN\\VLC\\vlc.exe", "–ú–µ–¥–∏–∞", "VLC", "üé¨"),
            "obs": ("obs-studio\\bin\\64bit\\obs64.exe", "–°—Ç—Ä–∏–º–∏–Ω–≥", "OBS", "üì∫"),
            "gimp": ("GIMP 2\\bin\\gimp-2.10.exe", "–ì—Ä–∞—Ñ–∏–∫–∞", "GIMP", "üé®"),
        }

        for key, (rel_path, cat, name, icon) in known_apps.items():
            for base in program_files:
                full_path = os.path.join(base, rel_path)
                if os.path.exists(full_path):
                    self.apps[key] = AppInfo(name, full_path, cat, "", icon)
                    break

        # PowerShell Start Menu
        try:
            ps_cmd = "Get-StartApps | Select-Object -First 30 | ConvertTo-Json"
            result = subprocess.run(
                ["powershell", "-Command", ps_cmd], capture_output=True, text=True
            )
            if result.returncode == 0:
                import json

                apps = json.loads(result.stdout)
                if not isinstance(apps, list):
                    apps = [apps]
                for app in apps:
                    if "Name" in app and "AppID" in app:
                        name = app["Name"]
                        key = name.lower().replace(" ", "_").replace("-", "_")[:20]
                        if key not in self.apps and len(name) < 40:
                            self.apps[key] = AppInfo(
                                name,
                                f'start "" "{app["AppID"]}"',
                                "–ú–µ–Ω—é –ü—É—Å–∫",
                                "",
                                "üìå",
                            )
        except:
            pass

    def _scan_linux(self):
        """–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Linux –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"""
        desktop_paths = [
            "/usr/share/applications",
            os.path.expanduser("~/.local/share/applications"),
            "/usr/local/share/applications",
        ]

        for d_path in desktop_paths:
            if os.path.exists(d_path):
                for desktop_file in Path(d_path).glob("*.desktop"):
                    self._parse_desktop_file(desktop_file)

        cli_apps = [
            ("firefox", "–ë—Ä–∞—É–∑–µ—Ä—ã", "Firefox", "ü¶ä"),
            ("chromium", "–ë—Ä–∞—É–∑–µ—Ä—ã", "Chromium", "üåê"),
            ("google-chrome", "–ë—Ä–∞—É–∑–µ—Ä—ã", "Chrome", "üåê"),
            ("brave", "–ë—Ä–∞—É–∑–µ—Ä—ã", "Brave", "ü¶Å"),
            ("code", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "VS Code", "üíª"),
            ("subl", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "Sublime", "üìù"),
            ("vim", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "Vim", "üìù"),
            ("nano", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "Nano", "üìù"),
            ("gedit", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "Gedit", "üìù"),
            ("gimp", "–ì—Ä–∞—Ñ–∏–∫–∞", "GIMP", "üé®"),
            ("inkscape", "–ì—Ä–∞—Ñ–∏–∫–∞", "Inkscape", "üé®"),
            ("vlc", "–ú–µ–¥–∏–∞", "VLC", "üé¨"),
            ("spotify", "–ú–µ–¥–∏–∞", "Spotify", "üéµ"),
            ("discord", "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "Discord", "üí¨"),
            ("telegram-desktop", "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "Telegram", "‚úàÔ∏è"),
            ("steam", "–ò–≥—Ä—ã", "Steam", "üéÆ"),
            ("obs", "–°—Ç—Ä–∏–º–∏–Ω–≥", "OBS", "üì∫"),
            ("blender", "3D", "Blender", "üé≤"),
            ("terminator", "–¢–µ—Ä–º–∏–Ω–∞–ª", "Terminator", "üíª"),
            ("konsole", "–¢–µ—Ä–º–∏–Ω–∞–ª", "Konsole", "üíª"),
            ("gnome-terminal", "–¢–µ—Ä–º–∏–Ω–∞–ª", "GNOME Terminal", "üíª"),
        ]

        for cmd, cat, name, icon in cli_apps:
            if self._which(cmd) and cmd not in self.apps:
                self.apps[cmd] = AppInfo(name, cmd, cat, "", icon)

        # Flatpak
        if self._which("flatpak"):
            try:
                result = subprocess.run(
                    ["flatpak", "list", "--app", "--columns=application,name"],
                    capture_output=True,
                    text=True,
                )
                if result.returncode == 0:
                    for line in result.stdout.strip().split("\n")[1:]:
                        parts = line.split("\t")
                        if len(parts) >= 2:
                            app_id = parts[0].strip()
                            name = parts[1].strip()
                            key = name.lower().replace(" ", "_")[:20]
                            if key not in self.apps:
                                self.apps[key] = AppInfo(
                                    name, f"flatpak run {app_id}", "Flatpak", "", "üì¶"
                                )
            except:
                pass

    def _parse_desktop_file(self, path: Path):
        """–ü–∞—Ä—Å–∏–Ω–≥ .desktop —Ñ–∞–π–ª–∞"""
        try:
            name = exec_cmd = categories = None

            with open(path, "r", encoding="utf-8", errors="ignore") as f:
                in_entry = False
                for line in f:
                    line = line.strip()
                    if line == "[Desktop Entry]":
                        in_entry = True
                    elif line.startswith("[") and in_entry:
                        break
                    elif in_entry:
                        if line.startswith("Name=") and not name:
                            name = line[5:]
                        elif line.startswith("Exec=") and not exec_cmd:
                            exec_cmd = line[5:]
                            for p in ["%f", "%F", "%u", "%U", "%c", "%k", "%i"]:
                                exec_cmd = exec_cmd.replace(p, "")
                            exec_cmd = exec_cmd.strip()
                        elif line.startswith("Categories="):
                            categories = line[11:].split(";")[0]
                        elif "NoDisplay=true" in line or "Hidden=true" in line:
                            return

            if name and exec_cmd:
                cmd_parts = exec_cmd.split()
                if cmd_parts:
                    cmd_name = cmd_parts[0]
                    if cmd_name.startswith("/"):
                        if not os.path.exists(cmd_name):
                            return
                    elif not self._which(cmd_name):
                        return

                key = name.lower().replace(" ", "_").replace("-", "_")[:25]
                cat = categories if categories else "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
                if key not in self.apps:
                    self.apps[key] = AppInfo(name, exec_cmd, cat)
        except:
            pass

    def _detect_apps(self):
        """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
        self.apps.clear()
        if self.is_windows:
            self._scan_windows()
        else:
            self._scan_linux()
        self.apps = dict(sorted(self.apps.items(), key=lambda x: x[1].name))

    def search_app(self, query: str) -> List[Tuple[str, AppInfo]]:
        """–ü–æ–∏—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"""
        query = query.lower()
        return [
            (k, v)
            for k, v in self.apps.items()
            if query in k or query in v.name.lower()
        ]

    def run(self):
        """–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Å –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–æ–π"""
        # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
        self._clear_and_redraw()

        while True:
            try:
                # –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∫—É—Ä—Å–æ—Ä –≤–Ω–∏–∑—É –¥–ª—è –≤–≤–æ–¥–∞
                print("\n  ‚û§ ", end="", flush=True)
                user_input = input().strip()

                if not user_input:
                    self._clear_message()
                    self._clear_and_redraw()
                    continue

                parts = user_input.split(maxsplit=1)
                cmd = parts[0].lower()
                arg = parts[1] if len(parts) > 1 else ""

                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥

                if cmd in ["quit", "q", "exit"]:
                    self._clear_and_redraw()
                    self._set_message("–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!", "info")
                    self._draw_message()
                    break

                elif cmd in ["help", "?", "h"]:
                    self._set_message("–°–ø—Ä–∞–≤–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –≤—ã—à–µ", "info")

                elif cmd == "refresh":
                    self._set_message("–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞...", "info")
                    self._clear_and_redraw()
                    self._detect_apps()
                    self._set_message(f"–ù–∞–π–¥–µ–Ω–æ {len(self.apps)} –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π", "success")

                elif cmd in ["list", "ls", "l"]:
                    self._clear_message()

                elif cmd == "search":
                    if arg:
                        results = self.search_app(arg)
                        if results:
                            self._set_message(
                                f"–ù–∞–π–¥–µ–Ω–æ: {', '.join([a.name for _, a in results[:5]])}",
                                "success",
                            )
                        else:
                            self._set_message("–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", "warning")
                    else:
                        self._set_message("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞", "warning")

                elif cmd == "fav":
                    if arg.isdigit():
                        num = int(arg)
                        if num in self.index_map:
                            key = self.index_map[num]
                            if key in self.favorites:
                                self.favorites.remove(key)
                                self._set_message(
                                    f"–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ: {self.apps[key].name}",
                                    "success",
                                )
                            else:
                                self.favorites.append(key)
                                self._set_message(
                                    f"–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ: {self.apps[key].name}",
                                    "success",
                                )
                            self._save_favorites()
                        else:
                            self._set_message("–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä", "error")
                    else:
                        self._set_message("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: fav [–Ω–æ–º–µ—Ä]", "warning")

                elif cmd in ["favs", "favorites"]:
                    if self.favorites:
                        names = [
                            self.apps[k].name for k in self.favorites if k in self.apps
                        ]
                        self._set_message(f"–ò–∑–±—Ä–∞–Ω–Ω–æ–µ: {', '.join(names[:5])}", "info")
                    else:
                        self._set_message("–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ", "warning")

                elif cmd.isdigit():
                    num = int(cmd)
                    if num in self.index_map:
                        key = self.index_map[num]
                        app = self.apps[key]
                        self._set_message(f"–ó–∞–ø—É—Å–∫: {app.name}...", "success")
                        self._clear_and_redraw()  # –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
                        self._run_command(app.command)
                    else:
                        self._set_message("–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä", "error")

                elif self._is_url(user_input):
                    self._open_url(user_input)

                else:
                    # –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
                    if cmd in self.apps:
                        app = self.apps[cmd]
                        self._set_message(f"–ó–∞–ø—É—Å–∫: {app.name}...", "success")
                        self._clear_and_redraw()
                        self._run_command(app.command)
                    else:
                        matches = self.search_app(cmd)
                        if len(matches) == 1:
                            key, app = matches[0]
                            self._set_message(f"–ó–∞–ø—É—Å–∫: {app.name}...", "success")
                            self._clear_and_redraw()
                            self._run_command(app.command)
                        elif len(matches) > 1:
                            names = [a.name for _, a in matches[:5]]
                            self._set_message(
                                f"–ù–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ: {', '.join(names)}", "warning"
                            )
                        else:
                            self._set_message(f"–ö–æ–º–∞–Ω–¥–∞ '{cmd}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", "error")

                # –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
                self._clear_and_redraw()

            except KeyboardInterrupt:
                self._clear_and_redraw()
                self._set_message("–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!", "info")
                self._draw_message()
                break
            except Exception as e:
                self._set_message(f"–û—à–∏–±–∫–∞: {e}", "error")
                self._clear_and_redraw()


def main():
    if sys.version_info < (3, 7):
        print("‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Python 3.7+")
        sys.exit(1)

    try:
        app = UniversalLauncher()
        app.run()
    except Exception as e:
        print(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        sys.exit(1)


if __name__ == "__main__":
    main()

```